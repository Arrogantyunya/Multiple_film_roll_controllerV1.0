
项目：		《LoRa单点集群卷膜机》

程序名称、版本： github和码云上版本控制
硬件版本：	DMCM -V6.0

日期：		2019-7-1


该版本主要改动有：

	1.采用新的LoRa模块，每一个卷膜机控制器都配备一个LoRa模块。
	
	2.根据MHL9LF LoRa模块，重新更改适配新的公有协议和卷膜机私有协议。
	
	3.新的协议最大的改动在于增加了区域号，工作组号，为组控，区域范围控制提供保障（集群控制）
	
	4.一次出差发现EEPROM问题，导致开关棚出现问题。新增加强制关棚、强制开棚指令，该指令无视开关棚需要的时间，
	  需要的开度脉冲，直接以上下限位为停止标志来卷膜。应用在开度卷膜出现误差、EEPROM等器件发生损坏等场景。
	  
	5.增加强制停止指令。在往常的出差调试电机正反转，限位时，每次重置行程，都需要等电机几分钟重置结束，或者
	  使用磁铁模拟上下下位结束（顶棚很难用磁铁），调试费时。强制停止指令可以在电机 重置行程  开度卷膜  强制开棚  强制关棚
	  下让电机停止（类似于暂停工作）。
	
	6.增加了周期性自检功能。使用定时器计数，如一个小时触发一次定时器中断。自检EEPROM储存的SN码、区域号、工作组号等，
	  如果其中一项自检失败，说明该数据储存异常，向服务器发送请求该数据指令，重新得到一份正确的数据。
	  
	7.增加LED状态提示，提示状态如下：
	  未注册到服务器 ---> 红灯1 500ms 闪烁
	  已注册到服务器，正常待机 ---> 绿灯1 1S 闪烁
	  重置行程 ---> 绿灯2 2S 闪烁
	  开度卷膜 ---> 绿灯2 1S 闪烁
	  强制开、关棚 ---> 绿灯2 500ms 闪烁
	  SN码、区域号、工作组号自检失败 ---> 红灯2 500ms 闪烁
	  配置LoRa通信参数失败--->红灯2 2S 闪烁

2019-7-1
	1.将卷膜计时超时时间额外增加了20秒
	2.原来将上一次，最新，实时开度保存在BKP寄存器，但这样有电池电量不足的风险，所以现在又保存一份到EEPROM，双保险保存。
	3.原来的过流阈值是0.1倍到1倍，因为龙街大棚的实际情况，现在改成0.1倍到10倍，以0.1倍为步进单位。
	  
	  
硬件功能提示：

	1.电流检测电路只有在自动模式下才接通，才能被检测到，手动模式不行。

功能按键流程：
（拨码开关，按下是低电平，抬起来是高电平）

第一个拨码开关：上面的是BOOT1，下面的是BOOT0
第二个拨码开关：

	K2：可以更开电机正反转向。当电机已经在工作时，更改无效。
	K1：可以更改电机上下限位。当电机已经在工作时，更改有效。

复位按键： （靠近拨码开关第一个按键）

按键一（往下走第二个）：
	（一）设备开机前（复位前），按住按键一不动，开机（复位）后等待蜂鸣器响，继续按着不动，等待第二次蜂鸣器响，进入工程调试模式。
	（二）设备开机后，如果设备没有注册到服务器，每按一次按键一5S左右，设备向服务器发送请求注册帧。

按键二（往下走第三个）：
	（一）设备开机前，按住按键二不动，开机后等待5秒左右，清除本机已注册到服务器标志位，意味着本机需要重新注册到服务器。
	（二）设备开机后，在工程调试模式下，按下按键二，电机开始重置行程。
	（三）设备已经注册到服务器，且正常工作中（不卷膜，空闲），按下按键5秒左右，清除电流阈值标志。

组合使用按键：
	（一）设备开机前，按住按键一不动，等待蜂鸣器响，蜂鸣器响后，在三秒之内，按住按键二，等待蜂鸣器响，蜂鸣器响了，松开按键二，这个时候程序会重新配置LoRa相关通信参数。


注意：当新版本程序存在时，老版本程序基本上不再适用于设备上，只适用于代码回顾和代码回滚。一切以最新版本程序为准。