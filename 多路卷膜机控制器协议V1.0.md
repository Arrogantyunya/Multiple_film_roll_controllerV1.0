## 多路卷膜机控制器各id字段解释

- **控制器设备类型（DeviceTypeId）：**多路卷膜机控制器（C003）

  > `控制器设备类型指`：每种大类型控制器的类型ID,比如卷膜机控制器、通用控制器等，该控制器需要按键上报LoRa参数，并配置SN等。

- 初始化原则：

  > 一个设备第一次发送申号指令时，区域ID以及SN全为0，然后就等待主机发送其他的设置指令。

## 一、多路卷膜机控制器公共指令

### 1.1、查询LORA主设备的参数（当前区域以及SN）frameId:A011）

`兼容预留设置LoRa设备时间及间隔协议`

`可查询主设备及子设备参数，role==0x00查询（或设置）主设备参数，role==0x55查询（或设置）所有设备参数，role==子设备路数，查询（或设置）相应路数参数`

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |            8             |    9     |         10-11          |      12-18      |      19-26       |  27  |       28-32       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------------------: | :------: | :--------------------: | :-------------: | :--------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID | 要求LoRa设备重新请求分号 | 查询角色 | LoRa设备的采集时间间隔 | 新设置的RTC时间 |     预留字段     | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |          intent          | channel  |        Interval        |     Newtime     |     Allocate     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |            1             |    1     |           2            |        7        |        8         |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A011   |    17    |       C003       |     00      |   01   |            55            |    00    |          003C          | 20190924132414  | 0000000000000000 |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明                     | 长度（byte） | 备注                                                         |
| --------------- | :----------------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头                 |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址                 |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| deviceOthers    | 控制字等                 |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头                     |      1       | FE                                                           |
| frameId         | 帧ID                     |      2       | 查看帧id对照表A011                                           |
| dataLen         | 数据长度                 |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID         |      2       | 查看设备类型对照表（C003）（5555：所有类型）                 |
| isBroadcast     | 是否广播                 |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id                   |      1       | 0x55表示所有区域                                             |
| intent          | 要求LoRa设备重新请求分号 |      1       | 0x00：不请求只设置参数，0x55：重新请求                       |
| channel         | 查询角色                 |      1       | 0x00：表示主控，0x55:表示所有设备参数，其他表示相应路数的子设备 |
| Interval        | LoRa设备的采集时间间隔   |      2       | 十六进制整数，单位为秒                                       |
| NewTime         | 新设置的RTC时间          |      7       | BCD码值，如`20180824141702`代表`2018年8月24日14点17分零2秒`  |
| Allocate        | 预留字段                 |      8       | 预留做他用                                                   |
| CRC8            | CRC8校验码               |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾                     |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

查询通用控制器（C003）【XX代表无所谓什么数值】

```c
61 0C0E2418 000000 FE A011 0D C003 00 XX XXXXXXXXXXXXXXXXXX D6 0D0A0D0A0D0A
61 0C4E5104 000000 FE A011 0D C003 00 01 000000000000000000 D6 0D0A0D0A0D0A
```

### 1.2基地服务器设置LoRa设备工作组编号(A012)

`channel==0x00表示设置主设备参数，channel==0x55表示设置所有子设备参数，等于其他表示设置其下属的某路子设备参数`

协议格式如下`表1-1-1`

#### 协议帧格式

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |     4\|5     |      6      |   7    |     8-12     |   13    |  14  |       15-20       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :----------: | :---------: | :----: | :----------: | :-----: | :--: | :---------------: |
|              |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 |   设备类型   |  是否广播   |  区域  |   编号数组   |  路数   | CRC8 |       帧尾        |
|    数据域    | DeviceFrameHead |   Addr   | deviceOthers | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast | ZoneId | GroupIdArray | channel | CRC8 |     FrameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |      2       |      1      |   1    |      5       |    1    |  1   |         2         |
|   示例数据   |       61        | 00000071 |   00 XXXX    |    FE     |  A012   |    10    |     C003     |     00      |   01   |  0000000000  |   00    |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域          | 说明         | 长度（byte） | 备注                                                         |
| --------------- | :----------- | :----------: | :----------------------------------------------------------- |
| DeviceFrameHead | 硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| Addr            | 设备地址     |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| deviceOthers    | 控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| FrameHead       | 帧头         |      2       | FE                                                           |
| FrameId         | 帧ID         |      2       | A012                                                         |
| DataLen         | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId    | 设备类型ID   |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast     | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId          | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| GroupIdArray    | 组编号数组   |      5       | 最多5个组，组id(2byte)不为00时有效                           |
| CRC8            | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd        | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

设置ID为`0C3B6214`的设备组编号数组为0100000000

```shell
61 0C3B6214 000100 FE A012 0A C003 00 01 0100000000 00 57 0D0A0D0A0D0A
```

**基地服务器发送设置指令(添加到发送队列)**

```javascript
addCmdToSenderPool('REPLACE', loRaSenderPacket);
```

**发生错误回复系统状态**

```javascript
__redisPub_sysConfigAck('LORA_COMMON_CMD', "SET_GROUP_ID_ARRAY", 'failure', "设置LoRa设备工作组编号发生错误", errInfo);
```

### 1.3、基地服务器设置设备（主/子）SN及子设备总路数(A013)

### 协议帧格式

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |     4\|5     |      6       |     7      |       8       |      9       |       10-18        |     19     |       20-25       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :----------: | :----------: | :--------: | :-----------: | :----------: | :----------------: | :--------: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 |  设备类型ID  | 是否广播指令 | 所属区域ID |   设备路数    | 子设备总路数 |  设置的LORA设备SN  | CRC8校验码 |       帧尾        |
|    数据域    | DeviceFrameHead |   Addr   | DeviceOthers | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast  |   ZoneId   | DeviceChannel | SlaverCount  |      DeviceSn      |    CRC8    |     FrameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |      2       |      1       |     1      |       1       |      1       |         9          |     1      |         2         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A013   |    0F    |     C003     |      55      |     01     |      00       |      00      | 000000000000000000 |     00     | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| DeviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| Addr            | 设备地址         |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| DeviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| FrameHead       | 帧头             |      1       | FE                                                           |
| FrameId         | 帧ID             |      2       | A013                                                         |
| DataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId    | 设备类型ID       |      2       | 查看设备类型对照表                                           |
| IsBroadcast     | 是否广播指令     |      1       | 0x55是，00否                                                 |
| ZoneId          | 所属区域Id       |      1       | 0x55表示所有区域                                             |
| DeviceChannel   | 设备路数         |      1       | 主设备：0x00                                                 |
| SlaverCount     | 子设备总路数     |      1       | 子设备总数                                                   |
| DeviceSn        | 设置的LoRa设备SN |      9       |                                                              |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```javascript
61 14432A0C 000100 FE A013 0E C003 01 00 02 C00320190304150001 15 0D0A0D0A0D0A
FE A013 0F C003 00 01 01 01 C003 20190926114601 E7 0D0A0D0A0D0A
```

### 1.4 查询LoRa设备当前工作状态（A014）

#### 协议帧格式，具体设备查看4

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |     4\|5     |      6       |   7    |    8    |    9     |     10     |       11-16       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :----------: | :----------: | :----: | :-----: | :------: | :--------: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 |  设备类型ID  | 是否广播指令 | 区域ID |  组ID   | 查询角色 | CRC8校验码 |       帧尾        |
|    数据域    | DeviceFrameHead |   Addr   | deviceOthers | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast  | ZoneId | GroupId | channel  |    CRC8    |     FrameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |      2       |      1       |   1    |    1    |    1     |     1      |         2         |
|   示例数据   |       61        | 00000071 |   00 XXXX    |    FE     |  A014   |    06    |     5555     |      55      |   01   |   01    |    00    |     00     | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域          | 说明         | 长度（byte） | 备注                                                         |
| --------------- | :----------- | :----------: | :----------------------------------------------------------- |
| DeviceFrameHead | 硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| Addr            | 设备地址     |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| deviceOthers    | 控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| FrameHead       | 帧头         |      2       | FE                                                           |
| FrameId         | 帧ID         |      2       | A011                                                         |
| DataLen         | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId    | 设备类型ID   |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast     | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId          | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| GroupId         | 组id         |      1       |                                                              |
| channel         | 查询角色     |      1       | 0x00：表示主控，0x55表示所有，其他表示相应路数的子设备       |
| CRC8            | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd        | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```javascript
61 14432A0C 000100 FE A014 04 C003 01 01 00 E1 0D0A0D0A0D0A
```

### 1.5强制停止工作指令（A015）

#### 协议帧格式

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3    |     4\|5     |      6      |   7    |    8    |    9    |  10  |       11-16       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :-----: | :----------: | :---------: | :----: | :-----: | :-----: | :--: | :---------------: |
|    数据域    | DeviceFrameHead |   Addr   | deviceOthers | FrameHead | FrameId | DataLen | DeviceTypeId | IsBroadcast | ZoneId | GroupId | channel | CRC8 |     FrameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1    |      2       |      1      |   1    |    1    |    1    |  1   |         2         |
|   示例数据   |       61        | 00000071 |   00 XXXX    |    FE     |  A015   |   06    |     5555     |     55      |   01   |   01    |   00    |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域          | 说明         | 长度（byte） | 备注                                                         |
| --------------- | :----------- | :----------: | :----------------------------------------------------------- |
| DeviceFrameHead | 硬件帧头     |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| Addr            | 设备地址     |      4       | 00000071(广播，所有设备上报自己的ID和SN)                     |
| deviceOthers    | 控制字等     |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| FrameHead       | 帧头         |      2       | FE                                                           |
| FrameId         | 帧ID         |      2       | A015                                                         |
| DataLen         | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId    | 设备类型ID   |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast     | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId          | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| GroupId         | 组Id         |      1       | 0x55表示所有组                                               |
| Addr            | 设备地址     |      4       | 设备地址（全部为55555555）                                   |
| channel         | 查询角色     |      1       | 0x00：表示主控，0x55表示所有，其他表示相应路数的子设备       |
| CRC8            | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd        | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

要求ID为`14052A0C`，的LoRa主设备重新上报设置参数：

```javascript
61 14432A0C 000100 FE A015 04 C003 01 00 E1 0D0A0D0A0D0A
```

### 1.6按键上报当前参数（frameId:E011)

#### 返回协议帧格式

|   字节索引   |     0     |  1\|2   |    3    |     4\|5     |      6      |   7    |     8-12     |       13-21        |   22    |  23-24   |     25-31      |      32-39       |  40  |       41-46       |
| :----------: | :-------: | :-----: | :-----: | :----------: | :---------: | :----: | :----------: | :----------------: | :-----: | :------: | :------------: | :--------------: | :--: | :---------------: |
|    数据域    | FrameHead | FrameId | DataLen | DeviceTypeId | IsBroadcast | ZoneId | GroupIdArray |      DeviceSn      | channel | Interval |    NewTime     |     Allocate     | CRC8 |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1    |      2       |      1      |   1    |      5       |         9          |    1    |    2     |       7        |        8         |  1   |         2         |
|   示例数据   |    FE     |  E011   |   24    |     C003     |     00      |   01   |  0100000000  | XXXXXXXXXXXXXXXXXX |   00    |  00 3C   | 20180824141702 | 0000000000000000 |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域       | 说明                   | 长度（byte） | 备注                                                         |
| ------------ | :--------------------- | :----------: | :----------------------------------------------------------- |
| FrameHead    | 帧头                   |      2       | FE                                                           |
| FrameId      | 帧ID                   |      2       | E011                                                         |
| DataLen      | 数据长度               |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId | 设备类型ID             |      2       | 查看设备类型对照表                                           |
| IsBroadcast  | 是否广播指令           |      1       | 0x55是，00否                                                 |
| ZoneId       | 所属区域Id             |      1       | 0x55表示所有区域                                             |
| channel      | 子设备路数             |      1       | 0x00表示主设备（无子设备情况），其他表示相应路数             |
| GroupIdArray | 组编号数组             |      5       | 最多5个组，组id(2byte)不为00时有效                           |
| Interval     | LoRa设备的采集时间间隔 |      2       | 十六进制整数，单位为秒                                       |
| NewTime      | 新设置的RTC时间        |      7       | BCD码值，如`20180824141702`代表`2018年8月24日14点17分零2秒`  |
| Allocate     | 预留字段               |      8       | 预留做他用                                                   |
| CRC8         | CRC8校验码             |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd     | 帧尾                   |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

ID为`14052A0C`的LoRa设备重新上报设置参数：

```javascript
41 0C256514 000500 FE E011 24 C003 55 01 0100000000 C00320190304150001 00 0000 FFFFFFFFFFFFFF 0000000000000000 D6 0D0A0D0A0D0A
```

1.7 LoRa设备请求设置工作组编号（E012）

#### 协议帧格式

|   字节索引   |     0     |  1\|2   |    3    |     4\|5     |      6      |   6    |    7    |  8   |       9-14        |
| :----------: | :-------: | :-----: | :-----: | :----------: | :---------: | :----: | :-----: | :--: | :---------------: |
|    数据域    | FrameHead | FrameId | DataLen | DeviceTypeId | IsBroadcast | ZoneId | channel | CRC8 |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1    |      2       |      1      |   1    |    1    |  1   |         2         |
|   示例数据   |    FE     |  E012   |   04    |     C003     |     55      |   01   |   00    |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域       | 说明         | 长度（byte） | 备注                                                         |
| ------------ | :----------- | :----------: | :----------------------------------------------------------- |
| FrameHead    | 帧头         |      2       | FE                                                           |
| FrameId      | 帧ID         |      2       | E012                                                         |
| DataLen      | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId | 设备类型ID   |      2       | 查看设备类型对照表                                           |
| IsBroadcast  | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId       | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| channel      | 设备路数     |      1       | 0x00表示主设备，其他表示相应路数                             |
| CRC8         | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd     | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```javascript
41 0C2A4314 00BB00 FE E012 04 C003 01 00 E1 0D0A0D0A0D0A
```



### 1.8LoRa设备请求设置SN设备类型及子设备路数(E013)

#### 协议帧格式

|   字节索引   |     0     |  1\|2   |    3     |     4\|5     |      6       |   7    |       8       |     9      |                   |
| :----------: | :-------: | :-----: | :------: | :----------: | :----------: | :----: | :-----------: | :--------: | :---------------: |
|     说明     |   帧头    |  帧ID   | 数据长度 |   设备类型   | 是否广播指令 |  区域  |   设备路数    | CRC8校验码 |       帧尾        |
|    数据域    | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast  | ZoneId | DeviceChannel |    CRC8    |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1     |      2       |      1       |   1    |       1       |     1      |         2         |
|   示例数据   |    FE     |  E013   |    05    |     C003     |      55      |   01   |      01       |     00     | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域        | 说明         | 长度（byte） | 备注                                                         |
| ------------- | :----------- | :----------: | :----------------------------------------------------------- |
| FrameHead     | 帧头         |      2       | FE                                                           |
| FrameId       | 帧ID         |      2       | E013                                                         |
| DataLen       | 数据长度     |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId  | 设备类型ID   |      2       | 查看设备类型对照表                                           |
| IsBroadcast   | 是否广播指令 |      1       | 0x55是，00否                                                 |
| ZoneId        | 所属区域Id   |      1       | 0x55表示所有区域                                             |
| DeviceChannel | 设备路数     |      1       | 主设备：0x00                                                 |
| CRC8          | CRC8校验码   |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd      | 帧尾         |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

```javascript
41 0C2A4314 004A00 FE E013 04 C003 01 00 E1 0D0A0D0A0D0A
610C3B6214000100FEA0120AC0030001010000000000570D0A0D0A0D0A
```

### 1.9LoRa设备上报实时工作状态（E014）

#### 返回协议帧格式

|   字节索引   |     0     |  1\|2   |    3    |     4\|5     |      6      |   7    |    8    |   9    | 10-11 |  12  |  13  |              14-29               |  30  |       31-36       |
| :----------: | :-------: | :-----: | :-----: | :----------: | :---------: | :----: | :-----: | :----: | :---: | :--: | :--: | :------------------------------: | :--: | :---------------: |
|    数据域    | FrameHead | FrameId | DataLen | DeviceTypeId | IsBroadcast | ZoneId | channel | status |  Vol  | Rssi | Csq  |             Allocate             | CRC8 |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1    |      2       |      1      |   1    |    1    |   1    |   2   |  1   |  1   |                16                |  1   |         2         |
|   示例数据   |    FE     |  E014   |   12    |     C003     |     55      |   01   |   00    |   00   | 2EE0  |  FF  |  FF  | 00000000000000000000000000000000 |  00  | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域       | 说明             | 长度（byte） | 备注                                                         |
| ------------ | :--------------- | :----------: | :----------------------------------------------------------- |
| FrameHead    | 帧头             |      2       | FE                                                           |
| FrameId      | 帧ID             |      2       | E014                                                         |
| DataLen      | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId | 设备类型ID       |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast  | 是否广播指令     |      1       | 0x55是，00否                                                 |
| ZoneId       | 所属区域Id       |      1       | 0x55表示所有区域                                             |
| status       | 设备当前工作状态 |      1       | 对应回执状态表                                               |
| Vol          | 电压             |      2       |                                                              |
| Rssi         | 性噪比           |      1       |                                                              |
| Csq          | 信号强度         |      1       |                                                              |
| Allocate     | 预留字段         |      16      | 预留做他用                                                   |
| CRC8         | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd     | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

ID为`14052A0C`的LoRa设备上报实时工作状态：

```
41 0C2A4314 00BF00 FE E014 29 C003 01 00 01 2EE0 FFFF 00000000000000000000000000000000 69 0D0A0D0A0D0A
```

开关型设备实时状态回复

预留字段实际使用说明

|   字节索引   |      14-15       |    16-18     |     19-21      |      22-29       |
| :----------: | :--------------: | :----------: | :------------: | :--------------: |
|    数据域    | CurrentOpenRatio | TotalWorkSec | CurrentWorkSec |     Allocate     |
| 长度（byte） |        2         |      3       |       3        |        8         |
|   示例数据   |       0000       |    0000FF    |     000000     | 0000000000000000 |

**CurrentOpenRatio**:设置开度

**TotalWorkSec**:设置工作时长

**CurrentWorkSec**:当前已工作时长

**Allocate**:根据不同开关型设备分别定义

状态表

|  状态名  | FactoryMode |   RUN_OK   | CLOSE_OK | OPEN_EXCEPTION | CLOSE_EXCEPTION | LOW_POWER  | SENSOR_EXCEPTION |
| :------: | :---------: | :--------: | :------: | :------------: | :-------------: | :--------: | :--------------: |
|  状态值  |     00      |     01     |    02    |       02       |       03        |     04     |        05        |
| 状态说明 |  出厂模式   | 设备运行中 | 设备关闭 |  打开设备异常  |  关闭设备异常   | 低电压异常 |    传感器异常    |

### 1.10 LoRa设备通用回执(E015)

#### 返回协议帧格式

|   字节索引   |     0     |  1\|2   |    3     |     4\|5     |      6       |   7    |    8    |   9    |      10-17       |     18     |       19-24       |
| :----------: | :-------: | :-----: | :------: | :----------: | :----------: | :----: | :-----: | :----: | :--------------: | :--------: | :---------------: |
|     说明     |   帧头    |  帧ID   | 数据长度 |   设备类型   | 是否广播指令 |  区域  |  路数   | 状态值 |     预留字段     | CRC8校验码 |       帧尾        |
|    数据域    | FrameHead | FrameId | DataLen  | DeviceTypeId | IsBroadcast  | ZoneId | channel | status |     Allocate     |    CRC8    |     FrameEnd      |
| 长度（byte） |     1     |    2    |    1     |      2       |      1       |   1    |    1    |   1    |        8         |     1      |         2         |
|   示例数据   |    FE     |  E015   |    0E    |     C003     |      55      |   01   |   00    |   00   | 0000000000000000 |     00     | 0D 0A 0D 0A 0D 0A |

协议帧各字段域说明：

| 字段域       | 说明             | 长度（byte） | 备注                                                         |
| ------------ | :--------------- | :----------: | :----------------------------------------------------------- |
| FrameHead    | 帧头             |      2       | FE                                                           |
| FrameId      | 帧ID             |      2       | E012                                                         |
| DataLen      | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| DeviceTypeId | 设备类型ID       |      2       | 查看设备类型对照表（5555：所有类型）                         |
| IsBroadcast  | 是否广播指令     |      1       | 0x55是，00否                                                 |
| ZoneId       | 所属区域Id       |      1       | 0x55表示所有区域                                             |
| Addr         | 设备地址         |      4       | 设备地址（全部为55555555）                                   |
| status       | 设备当前工作状态 |      1       | 对应回执状态表                                               |
| Allocate     | 预留字段         |      8       | 预留做他用                                                   |
| CRC8         | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| FrameEnd     | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

ID为`14052A0C`的LoRa设备通用回执（收到查询参数指令）：

```
410C2A4314006100  FE E015 0D C003 01 00 01 0000000000000000 16 0D0A0D0A0D0A
```

## 二、多路卷膜机控制器私有指令

### 2.1、☆设置LORA主设备的RTC时间（frameId:A018）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |     8-13     |  14  |       15-20       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :----------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |   RTC时间    | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId |     RTC      | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |      6       |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A018   |    0A    |       C003       |     00      |   01   | XXXXXXXXXXXX |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A018                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C003）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| RTC             | RTC时钟          |      6       | 年月日时分秒（130906093A14代表19年9月6日9点59分20秒）        |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0D 0A 0D 0A 0D 0A                                            |

**应用示例：**

设置通用控制器（C003）的RTC时间为19年9月6日9点59分20秒

```c
61 0C0E2418 000000 FE A018 0A C003 00 01 130906093B14 D6 0D0A0D0A0D0A
```

### 2.2、☆设置LORA主设备定时执行的时间段（frameId:A019）

**执行方式对照表**：

| 执行方式 | Turn off automatic execution | Daily implement | only once          | Reserve | Reserve |
| -------- | ---------------------------- | --------------- | ------------------ | ------- | ------- |
| 状态值   | 00                           | 01              | 02                 | 03      | 04      |
| 状态说明 | 关闭自动执行                 | 每天执行        | 仅对该区间执行一次 | 预留    | 预留    |

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |          8          |        9-10        |    11    |          12          | 13/13-15  | 14-19/16-21  | 20-25/22-27  | 26/28 |    27-32/29-34    |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-----------------: | :----------------: | :------: | :------------------: | :-------: | :----------: | :----------: | :---: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |      执行方式       | 输入输出接口类型ID | 设备路数 |      时间段序号      | 设定参数  |   开始时间   |   结束时间   |  CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | Mode implementation |  interfaceTypeId   | channel  | Time Sequence Number |   para    |  start time  |   end time   | CRC8  |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |          1          |         2          |    1     |          1           |    1/3    |      6       |      6       |   1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A019   |  16/18   |       C003       |     00      |   01   |         01          |        C003        |    01    |          xx          | 01/0125E1 | XXXXXXXXXXXX | XXXXXXXXXXXX |  00   | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域              | 说明             | 长度（byte） | 备注                                                         |
| ------------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead     | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr                | 设备地址         |      4       |                                                              |
| deviceOthers        | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead           | 帧头             |      1       | FE                                                           |
| frameId             | 帧ID             |      2       | 查看帧id对照表A019                                           |
| dataLen             | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId        | 控制器设备类型ID |      2       | 查看设备类型对照表（C003）                                   |
| isBroadcast         | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId              | 区域Id           |      1       |                                                              |
| Mode implementation | 执行方式         |      1       | 查看执行方式对照表                                           |
| interfaceTypeId     | 输入输出接口类型 |      2       | 查看输入输出接口类型对照表                                   |
| channel             | 设备路数         |      1       |                                                              |
| Time Sequence Numbe | 时间段序号       |      1       | 所设定时间段的序号                                           |
| para                | 设定参数         |     1/3      | 数字输出时为1字节，模拟输出时为3字节                         |
|                     |                  |              |                                                              |
|                     |                  |              |                                                              |
| CRC8                | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd            | 帧尾             |      6       | 0D 0A 0D 0A 0D 0A                                            |

| 执行方式 | Turn off automatic execution | Daily implement | only once          | Reserve | Reserve |
| -------- | ---------------------------- | --------------- | ------------------ | ------- | ------- |
| 状态值   | 00                           | 01              | 02                 | 03      | 04      |
| 状态说明 | 关闭自动执行                 | 每天执行        | 仅对该区间执行一次 | 预留    | 预留    |

**应用示例：**

设置通用控制器(C003)数字输出接口（C003）的3路）当前执行方式为每天执行（执行para为开启），开始时间段1为xxxxxxxxxxxx，结束时间段为xxxxxxxxxxxx。

```c
61 0C331C10 000000 FE A019 16 C003 00 01 01 C003 03 01 01 130907122009 13090713241A D6 0D0A0D0A0D0A
```

### 2.3、设置卷膜机控制器的开关状态（frameId:A020）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8    |    9     |   10-11   |    12-14     |      15-22       |  23  |       24-29       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-----: | :------: | :-------: | :----------: | :--------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |  组ID   | 设备路数 |   开度    | 超时关闭时间 |     预留字段     | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | groupId | channel  | OpenRatio |   WorkSec    |     Allocate     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |    1    |    1     |     2     |      3       |        8         |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  A020   |    13    |       C003       |     00      |   01   |   01    |    01    |   0000    |    000000    | 0000000000000000 |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域          | 说明             | 长度（byte） | 备注                                                         |
| --------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr            | 设备地址         |      4       |                                                              |
| deviceOthers    | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead       | 帧头             |      1       | FE                                                           |
| frameId         | 帧ID             |      2       | 查看帧id对照表A020                                           |
| dataLen         | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId    | 控制器设备类型ID |      2       | 查看设备类型对照表（C003）                                   |
| isBroadcast     | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId          | 区域Id           |      1       |                                                              |
| channel         | 设备路数         |      1       | 该接口设备的路数，从01开始编号                               |
| OpenRatio       | 开度             |      2       | 0x0064全开，0x0000全关                                       |
| WorkSec         | 超时关闭时间     |      3       | 0x000000表示一直保持当前状态,单位秒,                         |
| Allocate        | 预留字段         |      8       |                                                              |
| CRC8            | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd        | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

单播：设置区域01下的01组的多路卷膜机控制器打开，超时关闭时间为0x1F4（500）秒。

```c
61 0C0E2418 000000 FE A020 13 C003 00 01 01 55 0064 0001F4 0000000000000000 D6 0D0A0D0A0D0A
```

组播：设置区域01下的所有组的多路卷膜机控制器打开，超时关闭时间为0x1F4（500）秒。

```CQL
61 00000071 000000 FE A020 13 C003 55 01 55 55 0064 0001F4 0000000000000000 D6 0D0A0D0A0D0A
```

### 2.4、多路卷膜机控制器电流数值回执（frameId:E016）

**协议帧格式：**

|   字节索引   |       N/A       |   N/A    |     N/A      |     0     |  1\|2   |    3     |       4-5        |      6      |   7    |    8    |    9     |       10-12       |    13-15     |      16-23       |  23  |       24-29       |
| :----------: | :-------------: | :------: | :----------: | :-------: | :-----: | :------: | :--------------: | :---------: | :----: | :-----: | :------: | :---------------: | :----------: | :--------------: | :--: | :---------------: |
|     说明     |    硬件帧头     | 设备地址 |   控制字等   |   帧头    |  帧ID   | 数据长度 | 控制器设备类型ID |  是否广播   | 区域ID |  组ID   | 设备路数 |     电流数值      |  已工作时间  |     预留字段     | CRC  |       帧尾        |
|    数据域    | deviceFrameHead |   addr   | deviceOthers | frameHead | frameId | dataLen  |   deviceTypeId   | isBroadcast | zoneId | groupId | channel  | Current numerical | Working time |     Allocate     | CRC8 |     frameEnd      |
| 长度（byte） |        1        |    4     |      3       |     1     |    2    |    1     |        2         |      1      |   1    |    1    |    1     |         3         |      3       |        8         |  1   |         6         |
|   示例数据   |       61        | 14052A0C |   00 XXXX    |    FE     |  E016   |    14    |       C003       |     00      |   01   |   01    |    01    |       BCD码       |    000000    | 0000000000000000 |  00  | 0D 0A 0D 0A 0D 0A |

**协议帧各字段域说明：**

| 字段域            | 说明             | 长度（byte） | 备注                                                         |
| ----------------- | :--------------- | :----------: | :----------------------------------------------------------- |
| deviceFrameHead   | 硬件帧头         |      1       | 仁钰LoRa M-KL9按地址发送时需要                               |
| addr              | 设备地址         |      4       |                                                              |
| deviceOthers      | 控制字等         |      3       | 仁钰LoRa M-KL9按地址发送时需要                               |
| frameHead         | 帧头             |      1       | FE                                                           |
| frameId           | 帧ID             |      2       | 查看帧id对照表A020                                           |
| dataLen           | 数据长度         |      1       | 从此位后开始计算（不包含自身），一直到`CRCR8`位结束（不包括CRC8位） |
| deviceTypeId      | 控制器设备类型ID |      2       | 查看设备类型对照表（C003）                                   |
| isBroadcast       | 是否广播         |      1       | 55广播，00单播                                               |
| zoneId            | 区域Id           |      1       |                                                              |
| channel           | 设备路数         |      1       | 该接口设备的路数，从01开始编号                               |
| Current numerical | 电流数值         |      3       | 单位mA                                                       |
| Working time      | 已工作时间       |      3       | 单位秒,                                                      |
| Allocate          | 预留字段         |      8       |                                                              |
| CRC8              | CRC8校验码       |      1       | 用于进行CRC8计算的数据DataLen指代的长度                      |
| frameEnd          | 帧尾             |      6       | 0d 0a 0d 0a 0d 0a                                            |

**应用示例：**

区域01下的01组的多路卷膜机控制器打开，实时电流为35B6(13750)mA，已工作时间为0x1F4（500）秒。

```c
61 0C0E2418 000000 FE E016 13 C003 00 01 01 55 0035B6 0001F4 0000000000000000 D6 0D0A0D0A0D0A
```

